<!DOCTYPE html>
<html lang="ja">
    <head>
        <link type="text/css" rel="stylesheet" href="css/style.css">
        <meta charset="UTF-8">
        <title>User list</title>
    </head>
    <body>
        <!-- 6/23 ~
        顧客情報管理システムへの各機能追加 -->
        <!-- 課題01-情報の全件表示 -->
        <h1>顧客情報管理システム</h1>
        <form action="/" method="GET" id="form">
            <label for="select_text">検索したい名前を入力</label>
            <input type="text" id="inputvalue">
            <button type="button" id="sort_btn">並び替え</button>
        </form>
        <table>
            <tbody>
                <tr>
                    <th>ID</th>
                    <th>名　前</th>
                    <th>ふりがな</th>
                    <th>性　別</th>
                    <th>メールアドレス</th>
                    <th>電話番号</th>
                    <th>住　所</th>
                    <th>県　名</th>
                    <th>世 帯 数</th>
                </tr>
                <% personas.forEach(function(personas) { %>
                    <tr>
                        <td>
                            <%= personas.id %>
                        </td>
                        <td>
                            <%= personas.name %>
                        </td>
                        <td>
                            <%= personas.kana_name %>
                        </td>
                        <td>
                            <%= personas.gender %>
                        </td>
                        <td>
                            <%= personas.email %>
                        </td>
                        <td>
                            <%= personas.phone %>
                        </td>
                        <td>
                            <%= personas.address %>
                        </td>
                        <td>
                            <%= personas.workplace %>
                        </td>
                        <td>
                            <%= personas.household %>
                        </td>
                        <td>
                            <p><a href="/edit/<%= personas.id%>">更新</a></p>
                        </td>
                        <td>
                            <p><a href="/delete/<%= personas.id%>">削除</a></p>
                        </td>
                        <td>
                            <p><a href="#" onclick="selectRow(this.closest('tr'))">選択</a></p>
                        </td>
                    </tr>
                    <% }); %>
            </tbody>
        </table>
        <p><a href="/create">新規情報の追加</a></p>
        <h1>選択済み一覧</h1>
        <table id="selectedTable">
            <tbody>
                <tr>
                    <th>ID</th>
                    <th>名　前</th>
                    <th>ふりがな</th>
                    <th>性　別</th>
                    <th>メールアドレス</th>
                    <th>電話番号</th>
                    <th>住　所</th>
                    <th>県　名</th>
                    <th>世 帯 数</th>
                </tr>
            </tbody>
        </table>
        <!-- JS -->
        <script>
            // ボタン要素を取得
            const sortBtn = document.getElementById("sort_btn");

            // ボタンクリック時のイベントリスナーを設定
            sortBtn.addEventListener("click", function () {
                // テキストボックスの値を取得
                const keyword = document.getElementById("inputvalue").value.toLowerCase();

                // テーブルの行要素を取得
                const rows = document.querySelectorAll("tbody tr");

                // 行ごとにループして絞り込み
                rows.forEach(function (row) {
                    const nameCell = row.querySelector("td:nth-child(2)"); //名前のセルを取得
                    //◆名前でキーワード検索時◆
                    // 空の行でないかチェック
                    if (nameCell) {
                        const name = nameCell.textContent.toLowerCase();
                        //「名前」にキーワードが含まれている場合は表示、それ以外は非表示にする
                        if (name.includes(keyword)) {
                            row.style.display = "";
                        } else {
                            row.style.display = "none";
                        }
                    }
                });
            });
            // 課題02 - 情報を格納する機能
            // -----------
            // 選択＆移動
            // -----------
            function selectRow(row) {
                //選択済み一覧のテーブル要素を取得
                const selectedTable = document.getElementById("selectedTable");

                //選択された行から情報を取得
                const id        = row.querySelector("td:nth-child(1)").textContent;//ID
                const name      = row.querySelector("td:nth-child(2)").textContent;//名前
                const kanaName  = row.querySelector("td:nth-child(3)").textContent;//ふりがな
                const gender    = row.querySelector("td:nth-child(4)").textContent;//性別
                const email     = row.querySelector("td:nth-child(5)").textContent;//メールアドレス
                const phone     = row.querySelector("td:nth-child(6)").textContent;//電話番号
                const address   = row.querySelector("td:nth-child(7)").textContent;//住所
                const workplace = row.querySelector("td:nth-child(8)").textContent;//県名
                const household = row.querySelector("td:nth-child(9)").textContent;//世帯数

                //選択済み一覧に行を追加
                const newRow = document.createElement("tr");
                newRow.innerHTML = `
                <td>${id}</td>
                <td>${name}</td>
                <td>${kanaName}</td>
                <td>${gender}</td>
                <td>${email}</td>
                <td>${phone}</td>
                <td>${address}</td>
                <td>${workplace}</td>
                <td>${household}</td>`;

                selectedTable.appendChild(newRow);

                //選択された行を元の一覧から削除
                row.remove();
            }
        </script>
    </body>
</html>
